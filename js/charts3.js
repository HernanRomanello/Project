const series_18_chart3 = {
  series: [
    {
      name: "גברים",
      data: [3.2, 3.9, 2.1, 3, 3.8, 5.3, 5.8, 5.8, 9.3, 9.3],
    },
    {
      name: "נשים",
      data: [-3.4, -3.2, -2.6, -4.1, -5.4, -7.6, -8.4, -8.2, -9.1, -7.6],
    },
  ],
};

const series_12_chart3 = {
  series: [
    {
      name: "גברים",
      data: [3.4, 9.6, 11.4, 7.3, 3.2, 2.6, 3.7, 2.7, 3.9, 2.3],
    },
    {
      name: "נשים",
      data: [-2.5, -6.4, -8.8, -8, -7.5, -6.9, -6.2, -6.5, -3.8, -2.6],
    },
  ],
};

const series_6_chart3 = {
  series: [
    {
      name: "גברים",
      data: [2.5, 8.2, 11.8, 7, 4.5, 3.6, 3.1, 2.4, 3.3, 2.6],
    },
    {
      name: "נשים",
      data: [-4, -9.5, -11.5, -8.3, -5.7, -4.3, -4.2, -3.8, -2.7, -2.5],
    },
  ],
};

const series_3_chart3 = {
  series: [
    {
      name: "גברים",
      data: [2.6, 8.2, 12.4, 7.3, 4.9, 3.5, 2.5, 3.5, 3.2, 3],
    },
    {
      name: "נשים",
      data: [-4.6, -10.2, -10.8, -7.7, -5.5, -4.2, -4.2, -2.8, -3.1, -2.7],
    },
  ],
};

const series_chart3 =
  // same as aboveL: change to actual data
  {
    series: [
      {
        name: "גברים",
        data: [2.6, 8.2, 12.4, 7.3, 4.9, 3.5, 2.5, 2.5, 2.5, 3],
      },
      {
        name: "נשים",
        data: [-4.6, -10.2, -10.8, -7.7, -5.5, -4.2, -4.2, -2.8, -3.1, -2.7],
      },
    ],
  };

const series_18_chart3_departeds = {
  series: [
    {
      name: "גברים",
      data: [8.9, 18, 14.8, 8.5, 3.2, 3, 3.4, 2.2, 3.1, 2.9],
    },
    {
      name: "נשים",
      data: [-11.3, -16.3, -9.4, -4.8, -2.7, -2.7, -2.7, -3.2, -3.1, -0],
    },
  ],
};

const series_12_chart3_departeds = {
  series: [
    {
      name: "גברים",
      data: [13.4, 16.1, 12.4, 4.5, 2.4, 2.7, 0, 0, 2.5, 0],
    },
    {
      name: "נשים",
      data: [-16.6, -17.5, -8.4, -3.2, -3.6, -3.2, 0, -3.1, -0, -2.8],
    },
  ],
};

const series_6_chart3_departeds = {
  series: [
    {
      name: "גברים",
      data: [14.3, 17.8, 14.3, 4.7, 3.2, 2.4, 0, 0, 2.4, 0],
    },
    {
      name: "נשים",
      data: [-12.4, -17.8, -8.9, -3.9, -3.2, -3.4, 0, 0, 0, -2.8],
    },
  ],
};

const series_3_chart3_departeds = {
  series: [
    {
      name: "גברים",
      data: [17.2, 14.8, 16.4, 3.9, 3.6, 2.8, 0, 0, 0, 0],
    },
    {
      name: "נשים",
      data: [-10.9, -17.2, -11.7, -4.7, 0, 0, -2.8, 0, 0, 0],
    },
  ],
};

const series_chart3_departeds = {
  series: [
    {
      name: "גברים",
      data: [16.7, 16, 16.7, 0, 0, 3.8, 0, 0, 0, 0],
    },
    {
      name: "נשים",
      data: [0, 0, -17.3, 0, 0, 0, 0, 0, 0, 0],
    },
  ],
};

const series_18_chart3_ventilated = {
  series: [
    {
      name: "גברים",
      data: [2.8, 11.2, 17.1, 14.9, 8.3, 3.9, 3.6, 2.9, 2.4, 2.5],
    },
    {
      name: "נשים",
      data: [-2.7, -8.7, -9.9, -8.1, -4, -2.8, -3.6, -2.9, -3.3, -2.8],
    },
  ],
};

const series_12_chart3_ventilated = {
  series: [
    {
      name: "גברים",
      data: [5.3, 15.2, 16.3, 10.9, 5.1, 3.3, 2.9, 2.4, 2.6, 2.6],
    },
    {
      name: "נשים",
      data: [-4.7, -13.9, -12, -8.3, -3.1, -2.7, -3.4, -2.8, -2.6, -2.6],
    },
  ],
};

const series_6_chart3_ventilated = {
  series: [
    {
      name: "גברים",
      data: [3.1, 15.6, 16.9, 12.5, 4.4, 2.9, 3.3, 0, 2.6, 0],
    },
    {
      name: "נשים",
      data: [-4.4, -15, -10.6, -8.8, -3.3, -2.5, -2.6, 0, 0, -2.6],
    },
  ],
};

const series_3_chart3_ventilated = {
  series: [
    {
      name: "גברים",
      data: [4.5, 16.9, 18, 11.2, 3.4, 3.2, 0, 0, 3.1, 0],
    },
    {
      name: "נשים",
      data: [-3.4, -4.5, -10.1, -9, -3.1, -3.4, -3.1, 0, 0, -3.1],
    },
  ],
};

const series_chart3_ventilated = {
  series: [
    {
      name: "גברים",
      data: [4.8, 16.8, 14.3, 4.8, 0, 4.8, 0, 0, 4.8, 0],
    },
    {
      name: "נשים",
      data: [0, -9.5, -14.3, -9.5, -4.8, -4.8, 0, 0, 0, 0],
    },
  ],
};

const series_18_chart3_severe = {
  series: [
    {
      name: "גברים",
      data: [4.2, 11.6, 13, 10.7, 6.9, 4.2, 2.9, 2.7, 3.2, 2.8],
    },
    {
      name: "נשים",
      data: [-6.1, -11.9, -9.9, -7.2, -4.8, -4.9, -3.8, -2.8, -3.2, -3.2],
    },
  ],
};

const series_12_chart3_severe = {
  series: [
    {
      name: "גברים",
      data: [7.3, 16.4, 15.3, 7.4, 3.1, 3.4, 2.7, 3.3, 3.2, 2.5],
    },
    {
      name: "נשים",
      data: [-9.4, -17.3, -12, -5, -4.7, -3.6, -3.4, -3.4, -3.2, -2.8],
    },
  ],
};

const series_6_chart3_severe = {
  series: [
    {
      name: "גברים",
      data: [7.6, 15.4, 14.4, 7, 4, 4.5, 2.7, 2.5, 3.3, 2.3],
    },
    {
      name: "נשים",
      data: [-8.4, -17.8, -9.2, -4.9, -2.5, -2.8, -3.3, -2.7, -2.8, -2.9],
    },
  ],
};

const series_3_chart3_severe = {
  series: [
    {
      name: "גברים",
      data: [8.3, 12, 15.6, 8.7, 5.1, 2.8, 2.4, 3.1, 3.4, 0],
    },
    {
      name: "נשים",
      data: [-7.2, -17.3, -9.4, -5.1, -2.8, -3.1, -2.8, -3.7, 0, -3.7],
    },
  ],
};

const series_chart3_severe = {
  series: [
    {
      name: "גברים",
      data: [5.6, 5.6, 13.9, 5.6, 2.8, 0, 2.8, 0, 2.8, 0],
    },
    {
      name: "נשים",
      data: [-8.3, -16.2, -11.1, -11.1, -2.8, -2.8, 0, 0, 0, -2.8],
    },
  ],
};

const series_18_chart3_hospitalizeds = {
  series: [
    {
      name: "גברים",
      data: [3, 8.9, 10, 8.1, 5.5, 3.8, 2.4, 3.8, 3.1, 3.6],
    },
    {
      name: "נשים",
      data: [-4.4, -9.5, -8.2, -6, -4.4, -3.8, -5.7, -5.6, -3.3, -2.9],
    },
  ],
};

const series_12_chart3_hospitalizeds = {
  series: [
    {
      name: "גברים",
      data: [4.8, 13.6, 13.7, 7.1, 3.4, 3.5, 3, 3, 2.6, 3],
    },
    {
      name: "נשים",
      data: [-6.6, -14.5, -11.4, -5.5, -2.6, -2.6, -2.9, -3.5, -2.8, -2.6],
    },
  ],
};

const series_6_chart3_hospitalizeds = {
  series: [
    {
      name: "גברים",
      data: [5, 13.2, 13.9, 6.3, 3.3, 3.5, 3, 3.1, 2.9, 3.4],
    },
    {
      name: "נשים",
      data: [-6.6, -14.8, -11.4, -5.6, -2.2, -3.4, -2.8, -2.6, -2.8, -3.4],
    },
  ],
};

const series_3_chart3_hospitalizeds = {
  series: [
    {
      name: "גברים",
      data: [4.9, 12.2, 13.9, 6, 3.5, 2.7, 3, 3.2, 3.4, 3.1],
    },
    {
      name: "נשים",
      data: [-3.2, -15.5, -12.2, -5.4, -3, -3.6, -2.8, -2.7, -2.5, -3.2],
    },
  ],
};

const series_chart3_hospitalizeds = {
  series: [
    {
      name: "גברים",
      data: [3.6, 16, 14.1, 6.9, 2.9, 3, 2.8, 3, 2.7, 2.3],
    },
    {
      name: "נשים",
      data: [-5.9, -17.3, -13.1, -4.6, -3.3, -2.8, -3, -3.3, -3.3, -2.6],
    },
  ],
};

var options_g3 = {
  series: [
    {
      name: "גברים",
      data: [3.4, 9.6, 11.4, 7.3, 3.2, 2.6, 2.7, 5.7, 2.3, 2.1],
    },
    {
      name: "נשים",
      data: [-5.4, -12.8, -11.8, -7.3, -5.2, -3.4, -4.2, -3.4, -3.1, -2.7],
    },
  ],
  chart: {
    type: "bar",
    height: 300,
    stacked: true,
    parentHeightOffset: 0,
    background: "rgb(255,255,255)", // Example background color

    toolbar: {
      show: false,
    },
  },
  colors: ["rgb(80,203,253)", "rgb(182,202,81)"],
  plotOptions: {
    bar: {
      horizontal: true,
      barWidth: 1,
      style: { overflow: "visible" },
    },
  },
  dataLabels: {
    enabled: true,
    textAnchor: "middle",
    align: "right",
    style: {
      colors: ["black", "black"],
      position: "absolute",
      fontWeight: 100,
    },
    offsetX: 70,
    offsetY: 0,
    formatter: function (val, { seriesIndex, dataPointIndex, w }) {
      return Math.abs(val) + "%";
    },
  },
  stroke: {
    width: 1,
    height: 0.5,
    colors: ["#fff"],
  },
  grid: {
    row: {
      height: 10,
    },
    xaxis: {
      lines: {
        show: false,
      },
    },
    labels: {
      formatter: function (val) {
        return '<center class="legend-item-label">' + val + "</center>";
      },
    },
    background: "rgb(255, 0, 0)",
  },
  yaxis: {
    min: -30,
    max: 30,
    title: {
      text: "קבוצת גיל",
      style: {
        fontSize: "14px",
        fontWeight: 100,
        color: "black", // Change the font color to black
      },
      offsetX: 10,
    },
    labels: {
      // style: {},
    },
  },
  xaxis: {
    min: 0,
    max: 30,
    title: {
      useHTML: true,
      text: "מספר מאושפזים",
      style: {
        fontSize: "14px",
        fontWeight: 100,
        color: "black", // Change the font color to black
      },
    },
  },
  tooltip: {
    shared: true,
    intersect: false,
    x: {
      formatter: function (val) {
        return val;
      },
    },
    y: {
      formatter: function (val, { seriesIndex, dataPointIndex, w }) {
        var seriesName = w.config.series[seriesIndex].name;
        return seriesName + ": " + Math.abs(val) + "%";
      },
    },
  },
  title: {
    text: "",
  },
  legend: {
    position: "top",
  },
  xaxis: {
    type: "category",
    categories: [
      "90+",
      "80-89",
      "70-79",
      "60-69",
      "50-59",
      "40-49",
      "30-39",
      "20-29",
      "10-19",
      "0-9",
    ],
    title: {
      text: "% סה״כ",
      style: {
        color: "black", // Change the font color to black
        fontSize: "14px",
        fontWeight: 100,
        opacity: 0.5,
        padding: {
          top: 20,
          right: 10,
          bottom: 20,
          left: 10,
        },
      },
    },
    labels: {
      formatter: function (val, index) {
        var customLabels = ["30", "20", "10", "10", "20", "30"];
        return customLabels[index];
      },
    },
  },
};

function changeChartBackgroundColor(chart, color) {
  chart.updateOptions({
    chart: {
      background: color,
    },
  });
}

function changeFontColorToWhite(chart, color) {
  chart.updateOptions({
    dataLabels: {
      style: {
        colors: [color, color], // Change the font color to white
        position: "absolute",
        fontWeight: 100,
      },
    },
    yaxis: {
      title: {
        style: {
          color: color, // Change the font color to white
          fontSize: "14px",
          fontWeight: 100,
        },
      },
    },
    xaxis: {
      title: {
        style: {
          color: color, // Change the font color to white
          fontSize: "14px",
          fontWeight: 100,
        },
      },
    },
    legend: {
      labels: {
        colors: ["white", "white"], // Change the font color to white
      },
    },
    xaxis: {
      title: {
        style: {
          color: "white", // Change the font color to white
          fontSize: "14px",
          fontWeight: 100,
        },
      },
      labels: {
        style: {
          colors: [
            "white",
            "white",
            "white",
            "white",
            "white",
            "white",
            "white",
            "white",
            "white",
            "white",
          ], // Change the font color to white
        },
      },
    },
  });
}

function changeChartStyle(
  chart,
  fontColor,
  backgroundColor,
  manColor,
  womanColor
) {
  chart.updateOptions({
    chart: {
      type: "bar",
      height: 300,
      stacked: true,
      parentHeightOffset: 0,
      background: backgroundColor,
      toolbar: {
        show: false,
      },
    },
    colors: [manColor, womanColor],
    dataLabels: {
      enabled: true,
      textAnchor: "middle",
      align: "right",
      style: {
        colors: [fontColor, fontColor],
        position: "absolute",
        fontWeight: 100,
      },
      offsetX: 70,
      offsetY: 0,
      formatter: function (val, { seriesIndex, dataPointIndex, w }) {
        return Math.abs(val) + "%";
      },
    },
    stroke: {
      width: 1,
      height: 0.5,
      // colors: ["red"],
    },
    grid: {
      background: backgroundColor,
    },
    yaxis: {
      min: -30,
      max: 30,
      title: {
        text: "קבוצת גיל",
        style: {
          fontSize: "14px",
          fontWeight: 100,
          color: fontColor,
        },
        offsetX: 10,
      },
      labels: {
        style: {
          colors: [
            fontColor,
            fontColor,
            fontColor,
            fontColor,
            fontColor,
            fontColor,
            fontColor,
            fontColor,
            fontColor,
            fontColor,
          ], // Change the font color to white
        },
      },
    },
    // xaxis: {
    //   min: 0,
    //   max: 30,
    //   title: {
    //     useHTML: true,
    //     text: "מספר מאושפזים",
    //     style: {
    //       fontSize: "14px",
    //       fontWeight: 100,
    //       color: fontColor,
    //     },
    //   },
    // },
    // tooltip: {
    //   shared: true,
    //   intersect: false,
    //   x: {
    //     formatter: function (val) {
    //       return val;
    //     },
    //   },
    //   y: {
    //     formatter: function (val, { seriesIndex, dataPointIndex, w }) {
    //       var seriesName = w.config.series[seriesIndex].name;
    //       return seriesName + ": " + Math.abs(val) + "%";
    //     },
    //   },
    // },
    title: {
      text: "",
    },
    legend: {
      position: "top",
      labels: {
        colors: [fontColor, fontColor], // Change the font color to white
      },
    },
    xaxis: {
      // type: "category",
      // categories: [
      //   "90+",
      //   "80-89",
      //   "70-79",
      //   "60-69",
      //   "50-59",
      //   "40-49",
      //   "30-39",
      //   "20-29",
      //   "10-19",
      //   "0-9",
      // ],
      title: {
        text: "% סה״כ",
        style: {
          color: fontColor,
          fontSize: "14px",
          fontWeight: 100,
          opacity: 0.5,
          padding: {
            top: 20,
            right: 10,
            bottom: 20,
            left: 10,
          },
        },
      },
      labels: {
        style: {
          colors: [fontColor],
        },
        formatter: function (val, index) {
          var customLabels = ["30", "20", "10", "10", "20", "30"];
          return customLabels[index];
        },
      },
    },
  });
}

let chart_3 = new ApexCharts(document.querySelector("#g-3"), options_g3);
chart_3.render();

const openG1TimeSelect_chart3 = document.querySelector("#open-g3-time");
const select_time_chart3 = document.querySelector("#time-select-g3");
const g1cancelbutton_chart3 = document.getElementById("g3-cancel-button");
const g1okbutton_chart3 = document.getElementById("g3-ok-button");
const G1Container_chart3 = document.querySelector("#g3-container");

const populations_chart3 = [
  "מאומתים",
  "נפטרים",
  "מונשמים",
  "מצב קשה",
  "מאושפזים",
];
const populationsSelection_chart3 = [false, false, false, false, true];
const timeSpanSelection_chart3 = [false, false, false, false, true];

const seriesByTimeSpan_chart3 = {
  "[0.5,1]": series_chart3,
  "[0.5,2]": series_chart3_departeds,
  "[0.5,3]": series_chart3_ventilated,
  "[0.5,4]": series_chart3_severe,
  "[0.5,5]": series_chart3_hospitalizeds,

  "[1,1]": series_3_chart3,
  "[1,2]": series_3_chart3_departeds,
  "[1,3]": series_3_chart3_ventilated,
  "[1,4]": series_3_chart3_severe,
  "[1,5]": series_3_chart3_hospitalizeds,

  "[6,1]": series_6_chart3,
  "[6,2]": series_6_chart3_departeds,
  "[6,3]": series_6_chart3_ventilated,
  "[6,4]": series_6_chart3_severe,
  "[6,5]": series_6_chart3_hospitalizeds,

  "[12,1]": series_12_chart3,
  "[12,2]": series_12_chart3_departeds,
  "[12,3]": series_12_chart3_ventilated,
  "[12,4]": series_12_chart3_severe,
  "[12,5]": series_12_chart3_hospitalizeds,

  "[18,1]": series_18_chart3,
  "[18,2]": series_18_chart3_departeds,
  "[18,3]": series_18_chart3_ventilated,
  "[18,4]": series_18_chart3_severe,
  "[18,5]": series_18_chart3_hospitalizeds,
};

const radioButtonContent_chart3 = {
  0.5: "חודש אחרון",
  1: "3 חודשים",
  6: "6 חודשים",
  12: "שנה",
  18: "עד עכשיו",
};

const radioButtionPopulation_chart3 = {
  1: "מאומתים",
  2: "נפטרים",
  3: "מונשמים",
  4: "מצב קשה",
  5: "מאושפזים",
};

let lastPopulationGroup = 1;
let lastTimeSpan = 0.5;

function handleChartChange_chart3(
  timespanChecked,
  populationChecked,
  timeSpanValue,
  populationValue
) {
  // Function to change the time span and update the chart

  if (timeSpanValue) {
    lastTimeSpan = timeSpanValue;
  }
  if (populationValue) {
    lastPopulationGroup = populationValue;
  }
  let timeSpan = timeSpanValue ?? lastTimeSpan;
  let population = populationValue ?? lastPopulationGroup;
  if (timespanChecked || populationChecked)
    updateChartSeries_chart3(JSON.stringify([+timeSpan, +population]));
}

function updateChartSeries_chart3(chartId) {
  // Function to update the chart series based on checked checkboxes

  openG1TimeSelect_chart3.textContent = "";
  chart_3.updateOptions(seriesByTimeSpan_chart3[chartId]);
  const values = JSON.parse(chartId);
  openG1TimeSelect_chart3.textContent +=
    radioButtionPopulation_chart3[values[1]] +
    ", " +
    radioButtonContent_chart3[values[0]];
  openG1TimeSelect_chart3.innerHTML +=
    '<img class="" src ="./pics/down-arrow.svg" width="20" height="20"/>';
}

let selectedRadio2_chart3;
function createRadioButtons_chart3(list) {
  // Function to create radio buttons for time spans

  const label1 = document.createElement("label");
  label1.innerText = "הצג לפי";

  list.appendChild(label1);
  let populationEntries = Object.entries(radioButtionPopulation_chart3);
  for (let i = 0; i < populationEntries.length; i++) {
    let option = document.createElement("div");
    let checkbox = document.createElement("input");
    let span = document.createElement("span");

    option.addEventListener("click", function (e) {
      e.stopPropagation();
    });

    option.classList.add("option-country");
    checkbox.type = "radio";
    checkbox.name = "population-g3";
    checkbox.id = populationEntries[i][1];
    checkbox.value = populationEntries[i][0];
    checkbox.checked =
      selectedRadio2_chart3 &&
      selectedRadio2_chart3.id === populationEntries[i][1];

    checkbox.addEventListener("click", function (e) {
      populationsSelection_chart3[i] = !populationsSelection_chart3[i];
      selectedRadio2_chart3 = checkbox;
      e.stopPropagation();
    });

    span.textContent = populationEntries[i][1];
    option.appendChild(checkbox);
    option.appendChild(span);
    list.appendChild(option);
  }

  list.appendChild(document.createElement("hr"));

  const label2 = document.createElement("label");
  label2.innerText = "זמן";

  list.appendChild(label2);

  for (let i = 0; i < timeSpans.length; i++) {
    let option = document.createElement("div");
    let checkbox = document.createElement("input");
    let span = document.createElement("span");

    option.addEventListener("click", function (e) {
      e.stopPropagation();
    });

    option.classList.add("option-country");
    checkbox.type = "radio";
    checkbox.name = "timeSpan-country-g3";
    checkbox.id = timeSpans[i][0];
    checkbox.value = timeSpans[i][1];

    checkbox.checked = timeSpanSelection_chart3[i];

    span.textContent = timeSpans[i][0];
    option.appendChild(checkbox);
    option.appendChild(span);
    list.appendChild(option);
  }
}

g1okbutton_chart3.addEventListener("click", function () {
  // Event listener for the "OK" button

  const selectedRadio = document.querySelector(
    'input[name="timeSpan-country-g3"]:checked'
  );
  let allSelected = document.querySelectorAll(
    'input[name="timeSpan-country-g3"]'
  );
  for (let i = 0; i < allSelected.length; i++) {
    timeSpanSelection_chart3[i] = allSelected[i].checked;
  }
  let selectedRadioValue = undefined;
  let selectedRadioValue2 = undefined;

  if (selectedRadio) {
    selectedRadioValue = selectedRadio.value;
    openG1TimeSelect_chart3.click();
  }

  if (selectedRadio2_chart3) {
    selectedRadioValue2 = selectedRadio2_chart3.value;
  }

  handleChartChange_chart3(
    selectedRadio,
    selectedRadio2_chart3,
    selectedRadioValue,
    selectedRadioValue2
  );
});

function createGraphTimeSpanSelect_chart3(list) {
  // Function to create the entire graph time span select

  list.innerHTML = "";

  createRadioButtons_chart3(list);
}

function createGraphPupoltionAmountSelect_chart3(list) {
  list.innerHTML = "";

  // Create radio buttons for time spans
  createRadioButtons_chart3(list);
}

openG1TimeSelect_chart3.addEventListener("click", function () {
  createGraphTimeSpanSelect_chart3(select_time_chart3);
  G1Container_chart3.classList.toggle("hide");

  g1cancelbutton_chart3.addEventListener("click", function () {
    openG1TimeSelect_chart3.click();
  });

  const arrow3 = document.querySelector("#open-g3-time img");

  arrow3.classList.toggle("rotate-arrow");
});

function customizeLegendStylesAndMarker(borderRadius) {
  // Find the legend element
  var legend = document.querySelector(
    ".apexcharts-legend.apx-legend-position-top.apexcharts-align-center"
  );

  // Apply the custom styles to the legend
  if (legend) {
    legend.style.justifyContent = "start";
  }

  // Get all legend marker elements
  var legendMarkers = document.querySelectorAll(".apexcharts-legend-marker");

  // Loop through each legend marker and set the border radius
  legendMarkers.forEach(function (marker) {
    marker.style.borderRadius = borderRadius;
  });
}

setInterval(() => {
  customizeLegendStylesAndMarker("10px");
}, 100);
