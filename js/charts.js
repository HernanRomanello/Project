const series_18 = [
  {
    name: "קל",
    data: [
      ["02/03/2020", 155],
      ["16/08/2020", 454],
      ["30/01/2021", 637],
      ["16/7/2021", 112],
      ["30/12/2021", 348],
      ["15/06/2022", 746],
      ["29/11/2022", 518],
      ["15/05/2023", 218],
      ["29/10/2023", 76],
    ],

    color: "rgb(0,127,127,0.8)",
    marker: {
      symbol: "circle",
    },
  },
  {
    name: "בינוני",
    data: [
      ["28/06/2023", 175],
      ["19/07/2023", 190],
      ["19/08/2023", 229],
      ["30/8/2023", 16],
      ["20/09/2023", 20],
      ["11/10/2023", 139],
      ["1/11/2023", 45],
      ["22/11/2023", 18],
      ["13/12/2023", 1],
    ],
    color: "rgb(185,201,117)",
    marker: {
      symbol: "circle",
    },
  },
  {
    name: "קשה",
    data: [
      ["28/06/2023", 6],
      ["19/07/2023", 381],
      ["19/08/2023", 1103],
      ["30/8/2023", 48],
      ["20/09/2023", 214],
      ["11/10/2023", 89],
      ["1/11/2023", 154],
      ["22/11/2023", 24],
      ["13/12/2023", 19],
    ],
    color: "rgb(137,232,254)",
    marker: {
      symbol: "circle",
    },
  },
];

const series_12 = [
  {
    name: "קל",
    data: [
      ["25/15/2022", 470],
      ["06/02/2023", 332],
      ["21/03/2023", 397],
      ["15/6/2023", 201],
      ["28/07/2023", 116],
      ["9/09/2023", 182],
      ["22/10/2023", 261],
      ["4/12/2023", 100],
      ["04/12/2023", 62],
    ],

    color: "rgb(0,127,127,0.8)",
    marker: {
      symbol: "circle",
    },
  },
  {
    name: "בינוני",
    data: [
      ["25/15/2022", 60],
      ["06/02/2023", 62],
      ["21/03/2023", 23],
      ["15/6/2023", 17],
      ["28/07/2023", 8],
      ["9/09/2023", 4],
      ["22/10/2023", 16],
      ["4/12/2023", 3],
      ["04/12/2023", 3],
    ],
    color: "rgb(185,201,117)",
    marker: {
      symbol: "circle",
    },
  },
  {
    name: "קשה",
    data: [
      ["25/15/2022", 161],
      ["06/02/2023", 98],
      ["21/03/2023", 90],
      ["15/6/2023", 70],
      ["28/07/2023", 25],
      ["9/09/2023", 31],
      ["22/10/2023", 45],
      ["4/12/2023", 31],
      ["04/12/2023", 17],
    ],
    color: "rgb(137,232,254)",
    marker: {
      symbol: "circle",
    },
  },
];

const series_6 = [
  {
    name: "קל",
    data: [
      ["28/06/2023", 134],
      ["19/07/2023", 34],
      ["19/08/2023", 171],
      ["30/8/2023", 231],
      ["20/09/2023", 326],
      ["11/10/2023", 163],
      ["1/11/2023", 76],
      ["22/11/2023", 63],
      ["13/12/2023", 76],
    ],

    color: "rgb(0,127,127,0.8)",
    marker: {
      symbol: "circle",
    },
  },
  {
    name: "בינוני",
    data: [
      ["28/06/2023", 13],
      ["19/07/2023", 7],
      ["19/08/2023", 129],
      ["30/8/2023", 15],
      ["20/09/2023", 17],
      ["11/10/2023", 17],
      ["1/11/2023", 5],
      ["22/11/2023", 1],
      ["13/12/2023", 4],
    ],
    color: "rgb(185,201,117)",
    marker: {
      symbol: "circle",
    },
  },
  {
    name: "קשה",
    data: [
      ["28/06/2023", 26],
      ["19/07/2023", 34],
      ["19/08/2023", 129],
      ["30/8/2023", 51],
      ["20/09/2023", 48],
      ["11/10/2023", 62],
      ["1/11/2023", 19],
      ["22/11/2023", 13],
      ["13/12/2023", 10],
    ],
    color: "rgb(137,232,254)",
    marker: {
      symbol: "circle",
    },
  },
];

const series_3 = [
  {
    name: "קל",
    data: [
      ["26/09/2023", 124],
      ["7/10/2023", 174],
      ["18/10/2023", 214],
      ["29/10/2023", 231],
      ["9/11/2023", 306],
      ["20/11/2023", 163],
      ["1/12/2023", 73],
      ["12/12/2023", 63],
      ["23/12/2023", 65],
    ],

    color: "rgb(0,127,127,0.8)",
    marker: {
      symbol: "circle",
    },
  },
  {
    name: "בינוני",
    data: [
      ["26/09/2023", 12],
      ["7/10/2023", 7],
      ["18/10/2023", 8],
      ["29/10/2023", 7],
      ["9/11/2023", 21],
      ["20/11/2023", 17],
      ["1/12/2023", 6],
      ["12/12/2023", 2],
      ["23/12/2023", 3],
    ],
    color: "rgb(185,201,117)",
    marker: {
      symbol: "circle",
    },
  },
  {
    name: "קשה",
    data: [
      ["26/09/2023", 24],
      ["7/10/2023", 33],
      ["18/10/2023", 33],
      ["29/10/2023", 49],
      ["9/11/2023", 59],
      ["20/11/2023", 54],
      ["1/12/2023", 19],
      ["12/12/2023", 13],
      ["23/12/2023", 10],
    ],
    color: "rgb(137,232,254)",
    marker: {
      symbol: "circle",
    },
  },
];

const series = [
  {
    name: "קל",
    data: [
      ["18/11/2023", 62],
      ["19/11/2023", 68],
      ["20/11/2023", 61],
      ["21/11/2023", 60],
      ["22/11/2023", 57],
      ["23/11/2023", 58],
      ["24/11/2023", 57],
      ["25/11/2023", 57],
      ["26/11/2023", 26],
      ["27/11/2023", 55],
      ["28/11/2023", 57],
      ["29/11/2023", 51],
      ["30/11/2023", 54],
      ["01/12/2023", 56],
      ["02/12/2023", 61],
      ["03/12/2023", 63],
      ["04/12/2023", 61],
      ["05/12/2023", 57],
      ["06/12/2023", 61],
      ["07/12/2023", 66],
      ["08/12/2023", 63],
      ["09/12/2023", 72],
      ["10/12/2023", 72],
      ["11/12/2023", 65],
      ["12/12/2023", 63],
      ["13/12/2023", 64],
      ["14/12/2023", 65],
      ["15/12/2023", 53],
      ["16/12/2023", 36],
      ["17/12/2023", 36],
    ],
    color: "rgb(0,127,127,0.8)",
    marker: {
      symbol: "circle",
    },
  },
  {
    name: "בינוני",
    data: [
      ["18.11/2023", 1],
      ["19/11/2023", 2],
      ["20/11/2023", 1],
      ["21/11/2023", 1],
      ["22/11/2023", 2],
      ["23/11/2023", 1],
      ["24/11/2023", 1],
      ["25/11/2023", 0],
      ["26/11/2023", 1],
      ["27/11/2023", 1],
      ["28/11/2023", 3],
      ["29/11/2023", 1],
      ["30/11/2023", 0],
      ["01/12/2023", 1],
      ["02/12/2023", 1],
      ["03/12/2023", 3],
      ["04/12/2023", 3],
      ["05/12/2023", 4],
      ["06/12/2023", 3],
      ["07/12/2023", 1],
      ["08/12/2023", 2],
      ["09/12/2023", 2],
      ["10/12/2023", 1],
      ["11/12/2023", 6],
      ["12/12/2023", 4],
      ["13/12/2023", 3],
      ["14/12/2023", 2],
      ["15/12/2023", 3],
      ["16/12/2023", 3],
      ["17/12/2023", 3],
    ],
    color: "rgb(185,201,117)",
    marker: {
      symbol: "circle",
    },
  },
  {
    name: "קשה",
    data: [
      ["18/11/2023", 13],
      ["19/11/2023", 13],
      ["20/11/2023", 13],
      ["21/11/2023", 13],
      ["22/11/2023", 11],
      ["23/11/2023", 12],
      ["24/11/2023", 13],
      ["25/11/2023", 13],
      ["26/11/2023", 5],
      ["27/11/2023", 12],
      ["28/11/2023", 13],
      ["29/11/2023", 13],
      ["30/11/2023", 13],
      ["01/12/2023", 11],
      ["02/12/2023", 11],
      ["03/12/2023", 13],
      ["04/12/2023", 16],
      ["05/12/2023", 17],
      ["06/12/2023", 19],
      ["07/12/2023", 15],
      ["08/12/2023", 16],
      ["09/12/2023", 14],
      ["10/12/2023", 11],
      ["11/12/2023", 11],
      ["12/12/2023", 11],
      ["13/12/2023", 11],
      ["14/12/2023", 14],
      ["15/12/2023", 12],
      ["16/12/2023", 10],
      ["17/12/2023", 10],
    ],
    color: "rgb(137,232,254)",
    marker: {
      symbol: "circle",
    },
  },
];

//  copy
const showingSeries = JSON.parse(JSON.stringify(series));

const chart = Highcharts.chart("g-1", {
  chart: {
    type: "area",
    width: 420,
    height: 220,
    style: {
      marginInline: "auto",
    },
  },
  title: {
    text: "    ",
    align: "left",
  },
  xAxis: {
    type: "datetime",
    dateTimeLabelFormats: {
      day: "%e/%m", // Format for daily labels
    },
    tickInterval: 4 * 24 * 3600 * 1000, // One tick every 2 days
  },
  yAxis: {
    title: {
      useHTML: true,
      text: "מספר מאושפזים",
    },
    tickPositions: [0, 20, 40, 60, 80, 100], // Custom y-axis scale
  },

  legend: {
    verticalAlign: "top",
    rtl: true,
    textAnchor: "middle",
    align: "right",
    itemStyle: {
      font: 'normal 12px "Lucida Grande", "Lucida Sans Unicode", Verdana, Arial, Helvetica, sans-serif',
    },
  },
  tooltip: {
    useHTML: true,
    shared: true,
    headerFormat: '<span style="font-size:12px"><b>{point.key}</b></span><br>',
    pointFormat:
      '<div style="text-align: center; padding: 8px; color:{point.color}; white-space: nowrap;">\u25CF {series.name}: <b>{point.y}</b></div>',
    backgroundColor: "rgba(255, 255, 255, 1)",
    style: {
      fontSize: "12px",
    },
    point: {
      marginInline: "20px",
    },
  },

  plotOptions: {
    series: {
      pointStart: Date.UTC(2023, 10, 18), // Assuming the first date is in November (month index is 10)
      pointInterval: 12 * 3600 * 1000, // One day in milliseconds
    },
    area: {
      stacking: "normal",
      lineColor: "#666666",
      lineWidth: 1,
      marker: {
        lineWidth: 1,
        lineColor: "#666666",
      },
    },
  },
  exporting: {
    buttons: {
      contextButton: {
        enabled: false,
      },
    },
  },
  series: showingSeries,
});

const openG1TimeSelect = document.querySelector("#open-g1-time");
const select_time = document.querySelector("#time-select-g1");
const g1cancelbutton = document.getElementById("g1-cancel-button");
const g1okbutton = document.getElementById("g1-ok-button");
const G1Container = document.querySelector("#g1-container");
const levels = ["קל", "בינוני", "קשה"];
const timeSpanSelection1 = [false, false, false, false, true];
const seriesMapping = {
  קל: [true, showingSeries[0]],
  בינוני: [true, showingSeries[1]],
  קשה: [true, showingSeries[2]],
};

const seriesByTimeSpan = {
  0.5: series, // 1 month
  1: series_3, // 3 months
  6: series_6, // 6 months
  12: series_12, // 1 year
  18: series_18, // 2 years
};
const tickPositionsByTimeSpan = {
  0.5: [0, 20, 40, 60, 80, 100], //  1 month
  1: [0, 90, 180, 270, 360, 450], // 3 months
  6: [0, 90, 180, 270, 360, 450], // 6 months
  12: [0, 160, 320, 480, 640, 800], // 1 year
  18: [0, 800, 1600, 2400, 3200, 4000], // 2 years
};

const tickIntervalByTimeSpan = {
  0.5: 4 * 24 * 3600 * 1000, // 1 month
  1: 12 * 24 * 3600 * 1000, // 3 months
  6: 24 * 24 * 3600 * 1000, // 6 months
  12: 24 * 24 * 3600 * 1000, // 1 year
  18: 24 * 24 * 3600 * 1000, // 2 years
};

const radioButtonContent = {
  0.5: "חודש אחד",
  1: "3 חודשים",
  6: "6 חודשים",
  12: "שנה",
  18: "עד עכשיו",
};

const changeSeriesTimeSpan = function (timeSpan) {
  for (let i = 0; i < levels.length; i++) {
    seriesMapping[levels[i]][1] = seriesByTimeSpan[timeSpan][i];
  }
  chart.yAxis[0].update({
    tickPositions: tickPositionsByTimeSpan[timeSpan],
  });
  chart.xAxis[0].update({
    tickInterval: tickIntervalByTimeSpan[timeSpan],
    labels: {
      formatter: function () {
        // Format the date label as "DD.MM" (day and month)
        const date = new Date(this.value);
        const day = date.getDate();
        const month = date.getMonth() + 1; // Months are zero-based
        return `${day}.${month}`;
      },
    },
  });
};

function handleTimeSpanChange(checked, value) {
  // Function to change the time span and update the chart

  if (checked) {
    changeSeriesTimeSpan(value);
    updateChartSeries();
  }
}

function handleCheckboxClick(index) {
  // Function to handle checkbox click

  seriesMapping[levels[index]][0] = !seriesMapping[levels[index]][0];
}

function updateChartSeries() {
  // Function to update the chart series based on checked checkboxes

  chart.series.forEach((s) => s.remove());
  chart.series.forEach((s) => s.remove());

  openG1TimeSelect.textContent = "";
  for (var j = 0; j < levels.length; j++) {
    if (seriesMapping[levels[j]][0]) {
      chart.addSeries(seriesMapping[levels[j]][1]);
      openG1TimeSelect.textContent += levels[j];
      if (j < levels.length - 1) openG1TimeSelect.textContent += ", ";
    }
  }
}

function createLevelCheckbox(level, index, list) {
  // Function to create a checkbox for a level

  let option = document.createElement("div");
  let checkbox = document.createElement("input");
  let span = document.createElement("span");

  option.addEventListener("click", function (e) {
    e.stopPropagation();
  });

  checkbox.addEventListener("click", function (e) {
    handleCheckboxClick(index);
    e.stopPropagation();
  });

  span.textContent = level;
  option.classList.add("option-country");
  checkbox.type = "checkbox";
  checkbox.name = "level-country";
  checkbox.id = level;
  checkbox.checked = seriesMapping[level][0];
  checkbox.value = level;

  option.appendChild(checkbox);
  option.appendChild(span);
  list.appendChild(option);
}

function createRadioButtons(list) {
  // Function to create radio buttons for time spans

  for (let i = 0; i < timeSpans.length; i++) {
    let option = document.createElement("div");
    let checkbox = document.createElement("input");
    let span = document.createElement("span");

    option.classList.add("option-country");
    checkbox.type = "radio";
    checkbox.name = "timeSpan-country";
    checkbox.id = timeSpans[i][0];
    checkbox.value = timeSpans[i][1];

    if (timeSpanSelection1[i]) {
      checkbox.checked = true;
    }

    span.textContent = timeSpans[i][0];
    option.appendChild(checkbox);
    option.appendChild(span);
    list.appendChild(option);
  }
}

g1okbutton.addEventListener("click", function () {
  let selectedRadio = document.querySelector(
    'input[name="timeSpan-country"]:checked'
  );
  if (selectedRadio) {
    const value = selectedRadio.value;
    const content = radioButtonContent[value];
    handleTimeSpanChange(true, value);

    openG1TimeSelect.textContent += ", " + content;

    openG1TimeSelect.click();
  }
  openG1TimeSelect.innerHTML +=
    '<img class="" src ="./pics/down-arrow.svg" width="20" height="20"/>';
});

function createGraphTimeSpanSelect(list) {
  // Function to create the entire graph time span select

  list.innerHTML = "";
  const label2 = document.createElement("label");
  label2.innerText = "מצב מאושפזים";
  list.appendChild(label2);

  for (let i = 0; i < levels.length; i++) {
    createLevelCheckbox(levels[i], i, list);
  }

  list.appendChild(document.createElement("hr"));

  const label1 = document.createElement("label");
  label1.innerText = "זמן";
  list.appendChild(label1);
  createRadioButtons(list);
}

openG1TimeSelect.addEventListener("click", function () {
  createGraphTimeSpanSelect(select_time);
  G1Container.classList.toggle("hide");
  const arrow = document.querySelector("#open-g1-time img");

  setTimeout(function () {
    document
      .querySelectorAll('text[text-anchor="end"]')
      .forEach((t) => t.setAttribute("text-anchor", "start"));
  }, 100);

  arrow.classList.toggle("rotate-arrow");

  g1okbutton;
});

setTimeout(function () {
  document
    .querySelectorAll('text[text-anchor="end"]')
    .forEach((t) => t.setAttribute("text-anchor", "start"));
}, 100);

g1cancelbutton.addEventListener("click", function () {
  openG1TimeSelect.click();
});

function changeChartColors(chart, backgroundColor, fontColor) {
  if (chart) {
    chart.update({
      chart: {
        backgroundColor: backgroundColor,
      },
      xAxis: {
        labels: {
          style: {
            color: fontColor,
          },
        },
      },
      yAxis: {
        labels: {
          style: {
            color: fontColor,
          },
        },
        title: {
          useHTML: true,
          style: {
            color: fontColor,
          },
        },
      },
      legend: {
        itemStyle: {
          color: fontColor,
        },
      },
      tooltip: {
        style: {
          color: fontColor,
        },
      },
    });
  }
}
